# 事件格式规范
  该事件规范定义了前后端事件的交互格式，前端发送事件交给后端处理，并在`eDetail`中填写事件详细内容（部分事件不必填写，此时该项直接不写即可），后端处理好事件后将处理结果按规定格式填入`eDetail`中（`eDetail`原本内容直接清除），然后将事件回送给前端。
  事件的编号即发起时间需由前端填写，时间格式为自 1970 年 1 月 1 日后所经过的秒数。

[TOC]

## 推荐仓库事件
+ 前端发送事件
```js
{
  "eventID": 422743326,
  "userID": "Luoky76",
  "eType": "Recommend",
  "eTime": 1459994552.51
}
```
+ 前端接收事件
```js
{
  "eventID": 422743326,
  "userID": "Luoky76",
  "eType": "Recommend",
  "eDetail": [
    "https://github.com/Luoky76/GCat",
    "https://github.com/ShakingSH/bobing"
  ],
  "eTime": 1459994552.51
}
```
## 获取信息事件
+ 前端发送事件

  前端在`eDetail`中指明所需信息（键），其值放空即可，下例为前端一次性获取各类信息时的一种写法。
```js
{
  "eventID": 422743326,
  "userID": "Luoky76",
  "eType": "GetInfo",
  "eDetail": {
    "codeQuantity": "",
    "newRepositoryCnt": "",
    "finishedRepositoryCnt": "",
    "newCollaboratorCnt": "",
    "browseCnt": "c++",    //有"C++" "C" "Python" "QML" "Makefile" "JavaScript" "Shell" "HTML" "QMake" "Java" "" 这11种取值，"" 表示全部
    "browseList": "c++",
    "actionList": ""    //""表示全部，填写具体行为，有”push” “commit” “merge” ""4种取值
  },
  "eTime": 1459994552.51
}
```
+ 前端接收事件

  后端需要通过判断事件中是否存在特定键来判断前端是否需要该信息。可使用字典方法`__contains__(key)`，这是字典类的方法，用于判断字典中是否存在某一个键。
```js
{
  "eventID": 422743326,
  "userID": "Luoky76",
  "eType": "GetInfo",
  "eDetail": {
    "codeQuantity": 207890,
    "newRepositoryCnt": 3,
    "finishedRepositoryCnt": 5,
    "newCollaboratorCnt": 7,
    "browseCnt": 20, 
    "browseList": [
      "https://github.com/Luoky76/GCat",
      "https://github.com/ShakingSH/bobing"
    ],
    "actionList": [
      [
          "push",
          "2021/11/13 2:02"
      ],
      [
          "commit"	//注：commit后不带时间，其它操作均有时间。
      ]
    ],
  "eTime": 1459994552.51
}
```
## 更改用户信息事件
+ 前端发送事件

  以下事件表示关注用户`fireflylxx`，取关用户`ShakingSH`，收藏仓库`Luoky76/GCat`，取消收藏仓库`Luoky76/GCatDoc`。实际使用时一般一个事件只进行一个操作。
```js
{
  "eventID": 422743327,
  "userID": "Luoky76",
  "eType": "ChangeUserInfo",
  "eDetail": {
    "follow": "fireflylxx",
    "declineFollow": "ShakingSH",
    "star": "Luoky76/GCCat",
    "declineStar": "Luoky76/GCatDoc"
  },
  "eTime": 1259994663.62
}
```

+ 前端接收事件

  对应修改中填上是否成功的标记，即`success`或错误标号，成功与否仅取决于结果。关注一个已经关注过的用户，标记为`success`。
  错误标号请见下表：

错误标号 | 错误含义
:---: | :---: 
1 | 用户未登录
2 | 所关注用户不存在
3 | 所收藏仓库不存在

```js
{
  "eventID": 422743327,
  "userID": "Luoky76",
  "eType": "ChangeUserInfo",
  "eDetail": {
    "follow": "success",
    "declineFollow": "success",
    "star": "3",
    "declineStar": "success"
  },
  "eTime": 1259994663.62
}
```

## 登录事件
登录可参考[GitHub OAuth 第三方登录示例教程](http://www.ruanyifeng.com/blog/2019/04/github-oauth.html)、[使用GitHub-Flask实现GitHub登录和API交互](https://zhuanlan.zhihu.com/p/39026635)

+ 前端发送事件

```js
{
  "eventID": 422743328,
  "eType": "Login",
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
  "eventID": 422743328,
  "eType": "Login",
  "eDetail": "https://github.com/login/oauth/authorize?client_id=7e015d8ce32370079895&redirect_uri=http://localhost:8080/oauth/redirect",
  "eTime": 1262224321.17
```

## 创建仓库事件
+ 前端发送事件

```js
{
  "eventID": 422743329,
  "userID": "Luoky76",
  "repoID": "Luoky76/NewRepo",
  "eType": "CreateRepo",
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743329,
  "userID": "Luoky76",
  "repoID": "Luoky76/NewRepo",
  "eType": "CreateRepo",
  "eDetail": "success",    //若发生错误，使用前文的错误标号表
  "eTime": 1262224321.17
}
```

## 更新仓库事件
+ 前端发送事件

```js
{
  "eventID": 422743330,
  "repoID": "Luoky76/GCat",
  "eType": "UpdateRepo",
  "Detail": {
    //暂未决定，视 GitHub 提供的 API 决定
  }
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743330,
  "repoID": "Luoky76/GCat",
  "eType": "UpdateRepo",
  "Detail": {
    //暂未决定，视 GitHub 提供的 API 决定
  }
  "eTime": 1262224321.17
}
```

## 搜索仓库事件
该搜索由后端调用`GitHub`的`API`，前端须在`Detail`中填上搜索的关键词，后端在`Detail`中返回搜索的仓库结果。

+ 前端发送事件

```js
{
  "eventID": 422743331,
  "eType": "SearchRepo",
  "Detail": [
    "GitHub",
    "WeChat"
  ]
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743331,
  "eType": "SearchRepo",
  "Detail": [
    "https://github.com/Luoky76/GCat",
    "https://github.com/ShakingSH/bobing"
  ]
  "eTime": 1262224321.17
}
```