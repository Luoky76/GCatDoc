# 事件格式规范
  该事件规范定义了前后端事件的交互格式，前端发送事件交给后端处理，并在`eDetail`中填写事件详细内容（部分事件不必填写，此时该项直接不写即可），后端处理好事件后将处理结果按规定格式填入`eDetail`中（`eDetail`原本内容直接清除），然后将事件回送给前端。
  事件的编号即发起时间需由前端填写，时间格式为自 1970 年 1 月 1 日后所经过的秒数。

[TOC]

##  错误标号表
错误标号 | 错误含义
:---: | :---: 
error 1 | 用户 Token 错误
error 2 | 所关注用户不存在
error 3 | 所收藏仓库不存在

## 登录事件
+ 前端发送事件
```js
{
  "eventID": 422743325,
  "token": "user's token",	//在 token 里填写用户访问令牌
  "eType": "Login",
  "eTime": 1459994552.51
}
```
+ 前端接收事件
```js
{
  "eventID": 422743325,
  "eType": "Login",
  "eDetail": "success",	//若发生错误，使用错误标号
  "eTime": 1459994552.51
}
```
## 推荐仓库事件
+ 前端发送事件
```js
{
  "eventID": 422743326,
  "token": "user's token",
  "eType": "Recommend",
  "eTime": 1459994552.51
}
```
+ 前端接收事件
```js
{
  "eventID": 422743326,
  "eType": "Recommend",
  "eDetail": [
    "https://api.github.com/repos/Luoky76/GCat",
    "https://api.github.com/repos/ShakingSH/bobing"
  ],
  "eTime": 1459994552.51
}
```
## 获取信息事件
+ 前端发送事件

  前端在`eDetail`中指明所需信息（键），其值放空即可，下例为前端一次性获取各类信息时的一种写法。
  
  `allBrowseList`和`browseList`的区别在于是否对不同语言的浏览加以区分，如`C++`和`Python`。
  
  `allActionList`和`actionList`的区别在于是否对不同种类的行动加以区分，如`push`和`commit`。
  
  详细可见接收事件中的内容。
```js
{
  "eventID": 422743326,
  "token": "user's token",
  "eType": "GetInfo",
  "eDetail": {
    "codeQuantity": "",
    "newRepository": "",
    "newCollaborator": "",
    "allBrowseList": "",
    "browseList": "",
    "allActionList": "",
    "actionList": ""
  },
  "eTime": 1459994552.51
}
```
+ 前端接收事件

  后端需要通过判断事件中是否存在特定键来判断前端是否需要该信息。
```js
{
  "eventID": 422743326,
  "eType": "GetInfo",
  "eDetail": {
    "codeQuantity": "114514",
    "newRepository": {
      "cnt": 2,
      "repoList": [
        "https://api.github.com/repos/Luoky76/GCat",
        "https://api.github.com/repos/ShakingSH/bobing"
      ]
    },
    "newCollaborator": {
      "cnt": 3,
      "userID": [
        "Luoky76",
        "ShakingSH",
        "ShakingSH"
      ],
      "repoList": [
        "https://api.github.com/repos/Luoky76/GCat",
        "https://api.github.com/repos/Luoky76/GCat",
        "https://api.github.com/repos/ShakingSH/bobing"
      ],
      "time": [
        "2021/11/3 22:41",
        "2021/11/3 10:41",
        "2021/11/2 05:30"
      ]
    },
    "allBrowseList": {
      "cnt": 2,
      "repoList": [
        "https://api.github.com/repos/Luoky76/GCat",
        "https://api.github.com/repos/ShakingSH/bobing"
      ],
      "time": [
        "2021/11/3 22:41",
        "2021/11/2 05:30"
      ]
    },
    "browseList": {
      "C++": {
        "cnt": 2,
        "repoList": [
          "https://api.github.com/repos/Luoky76/GCat",
          "https://api.github.com/repos/ShakingSH/bobing"
        ]
        "time": [
          "2021/11/3 22:41",
          "2021/11/2 05:30"
        ]
      },
      "Python": {
        "cnt": 2,
        "repoList": [
          "https://api.github.com/repos/fireflylxx/learning1",
          "https://api.github.com/repos/fireflylxx/login-test"
        ]
        "time": [
          "2021/9/20 21:23",
          "2021/11/14 23:21"
        ]
      }
    },
    "allActionList": {
      "cnt": 3,
      "action": [
        "push",
        "commit",
        "merge"
      ],
      "repoList": [
        "https://api.github.com/repos/Luoky76/GCat",
        "https://api.github.com/repos/Luoky76/GCat",
        "https://api.github.com/repos/ShakingSH/bobing"
      ],
      "time": [
        "2021/10/10 12:20",
        "2021/10/10 12:20",
        "2021/10/10 13:07"
      ]
    },
    "actionList": {
      "push": {
        "cnt": 1,
        "repoList": [
          "https://api.github.com/repos/Luoky76/GCat"
        ]
        "time": [
          "2021/10/10 12:20"
        ]
      },
      "commit": {
        "cnt": 2,
        "repoList": [
          "https://api.github.com/repos/fireflylxx/learning1",
          "https://api.github.com/repos/fireflylxx/login-test"
        ]
        "time": [
          "2021/11/10 15:47",
          "2021/11/7 14:31"
        ]
      },
      "merge": {
        "cnt": 2,
        "repoList": [
          "https://api.github.com/repos/fireflylxx/learning1",
          "https://api.github.com/repos/fireflylxx/login-test"
        ]
        "time": [
          "2021/11/11 15:57",
          "2021/11/6 11:34"
        ]
      }
    }
  },
  "eTime": 1459994552.51
}
```
## 更改用户信息事件
+ 前端发送事件

  以下事件表示关注用户`fireflylxx`，取关用户`ShakingSH`，收藏仓库`Luoky76/GCat`，取消收藏仓库`Luoky76/GCatDoc`。实际使用时一般一个事件只进行一个操作。
```js
{
  "eventID": 422743327,
  "token": "user's token",
  "eType": "ChangeUserInfo",
  "eDetail": {
    "follow": "fireflylxx",
    "declineFollow": "ShakingSH",
    "star": "Luoky76/GCCat",
    "declineStar": "Luoky76/GCatDoc",
    "checkStar": "Luoky76/GCatDoc"
  },
  "eTime": 1259994663.62
}
```

+ 前端接收事件

  对应修改中填上是否成功的标记，即`success`或错误标号，成功与否仅取决于结果。关注一个已经关注过的用户，标记为`success`。

```js
{
  "eventID": 422743327,
  "eType": "ChangeUserInfo",
  "eDetail": {
    "follow": "success",
    "declineFollow": "success",
    "star": "error 3",
    "declineStar": "success",
    "checkStar": "yes"	//有收藏返回 yes ，否则返回 no
  },
  "eTime": 1259994663.62
}
```

## 创建仓库事件
+ 前端发送事件

```js
{
  "eventID": 422743329,
  "repoID": "NewRepo",
  "token": "user's token",	//在 userToken 里填写用户访问令牌
  "eType": "CreateRepo",
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743329,
  "repoID": "NewRepo",
  "eType": "CreateRepo",
  "eDetail": "success",    //若发生错误，使用前文的错误标号表
  "eTime": 1262224321.17
}
```

## 更新仓库事件
+ 前端发送事件

```js
{
  "eventID": 422743330,
  "repoID": "GCat",
  "token": "user's token",
  "eType": "UpdateRepo",
  "Detail": {
    //暂未决定，视 GitHub 提供的 API 决定
  }
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743330,
  "repoID": "GCat",
  "eType": "UpdateRepo",
  "Detail": {
    //暂未决定，视 GitHub 提供的 API 决定
  }
  "eTime": 1262224321.17
}
```

## 搜索仓库事件
该搜索由后端调用`GitHub`的`API`，前端须在`Detail`中填上搜索的关键词，后端在`Detail`中返回搜索的仓库结果。

+ 前端发送事件

```js
{
  "eventID": 422743331,
  "eType": "SearchRepo",
  "Detail": [
    "GitHub",
    "WeChat"
  ]
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743331,
  "eType": "SearchRepo",
  "Detail": [
    "https://github.com/Luoky76/GCat",
    "https://github.com/ShakingSH/bobing"
  ]
  "eTime": 1262224321.17
}
```

## 获取仓库文件事件

+ 前端发送事件

```js
{
  "eventID": 422743332,
  "userID": "Luoky76",
  "repoID": "GCat",
  "eType": "GetFile",
  "Detail": {
    "filepath": "此处填写所需文件路径",
    "filetype": "file"	//此处有两种取值，"file" "dir"，分别表示文件，文件夹
  }
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743332,
  "userID": "Luoky76",
  "repoID": "GCat",
  "eType": "GetFile",
  "Detail": "文件内容"	//当 filetype 为 file 时
  "eTime": 1262224321.17
}
```

```js
{
  "eventID": 422743332,
  "userID": "Luoky76",
  "repoID": "GCat",
  "eType": "GetFile",
  "Detail": {
    "文件路径": "文件类型",
    "文件路径": "文件类型"
  }	//当 filetype 为 dir 时
  "eTime": 1262224321.17
}
```

## 获取仓库文件列表事件

+ 前端发送事件

```js
{
  "eventID": 422743333,
  "userID": "Luoky76",
  "repoID": "GCat",
  "eType": "GetFileList",
  "eTime": 1262224321.17
}
```

+ 前端接收事件

```js
{
  "eventID": 422743333,
  "userID": "Luoky76",
  "repoID": "GCat",
  "eType": "GetFileList",
  "eDetail": {
    "文件路径": "文件类型",
    "文件路径": "文件类型"
  }
  "eTime": 1262224321.17
}
```